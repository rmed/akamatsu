(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define('bulmaTagsinput',b):a.bulmaTagsinput=b()})(this,function(){'use strict';const a=['click','touchstart'],b=188;class c{constructor(a,b={}){if(this.element='string'==typeof a?document.querySelector(a):a,!this.element)throw new Error('An invalid selector or non-DOM node has been provided.');this.options=Object.assign({},{disabled:!1,delimiter:',',allowDelete:!0,lowercase:!1,uppercase:!1,duplicates:!0},b),this.element.dataset.hasOwnProperty('lowercase')&&(this.options.lowercase=this.element.dataset('lowercase')),this.element.dataset.hasOwnProperty('uppercase')&&(this.options.lowercase=this.element.dataset('uppercase')),this.element.dataset.hasOwnProperty('duplicates')&&(this.options.lowercase=this.element.dataset('duplicates')),this.init()}static attach(a='input[type="tags"]',b={}){let d=[];const e=document.querySelectorAll(a);return[].forEach.call(e,(a)=>{setTimeout(()=>{d.push(new c(a,b))},100)}),d}init(){if(!this.options.disabled){this.tags=[],this.container=document.createElement('div'),this.container.className='tagsinput',this.container.classList.add('field'),this.container.classList.add('is-grouped'),this.container.classList.add('is-grouped-multiline'),this.container.classList.add('input');let a=this.element.getAttribute('type');a&&'tags'!==a||(a='text'),this.input=document.createElement('input'),this.input.setAttribute('type',a),this.element.getAttribute('placeholder')?this.input.setAttribute('placeholder',this.element.getAttribute('placeholder')):this.input.setAttribute('placeholder','Add a Tag'),this.container.appendChild(this.input);let b=this.element.nextSibling;this.element.parentNode[b?'insertBefore':'appendChild'](this.container,b),this.element.style.cssText='position:absolute;left:0;top:0;width:1px;height:1px;opacity:0.01;',this.element.tabIndex=-1,this.enable()}}enable(){this.enabled||this.options.disabled||(this.element.addEventListener('focus',()=>{this.container.classList.add('is-focused'),this.select(Array.prototype.slice.call(this.container.querySelectorAll('.tag:not(.is-delete)')).pop())}),this.input.addEventListener('focus',()=>{this.container.classList.add('is-focused'),this.select(Array.prototype.slice.call(this.container.querySelectorAll('.tag:not(.is-delete)')).pop())}),this.input.addEventListener('blur',()=>{this.container.classList.remove('is-focused'),this.select(Array.prototype.slice.call(this.container.querySelectorAll('.tag:not(.is-delete)')).pop()),this.savePartial()}),this.input.addEventListener('keydown',(a)=>{let c,d=a.charCode||a.keyCode||a.which,e=this.container.querySelector('.tag.is-active'),f=Array.prototype.slice.call(this.container.querySelectorAll('.tag:not(.is-delete)')).pop(),g=this.caretAtStart(this.input);if(e&&(c=this.container.querySelector('[data-tag="'+e.innerHTML.trim()+'"]')),this.setInputWidth(),d===13||d===this.options.delimiter.charCodeAt(0)||d===b||d===9){if(!this.input.value&&(d!==this.options.delimiter.charCodeAt(0)||d===b))return;this.savePartial()}else if(d===46&&c)c.nextSibling?this.select(c.nextSibling.querySelector('.tag')):c.previousSibling&&this.select(c.previousSibling.querySelector('.tag')),this.container.removeChild(c),this.tags.splice(this.tags.indexOf(c.getAttribute('data-tag')),1),this.setInputWidth(),this.save();else if(d===8){if(c)c.previousSibling?this.select(c.previousSibling.querySelector('.tag')):c.nextSibling&&this.select(c.nextSibling.querySelector('.tag')),this.container.removeChild(c),this.tags.splice(this.tags.indexOf(c.getAttribute('data-tag')),1),this.setInputWidth(),this.save();else if(f&&g)this.select(f);else return;}else if(d===37){if(c)c.previousSibling&&this.select(c.previousSibling.querySelector('.tag'));else{if(!g)return;this.select(f)}}else if(d===39){if(!c)return;this.select(c.nextSibling.querySelector('.tag'))}else return this.select();return a.preventDefault(),!1}),this.input.addEventListener('input',()=>{this.element.value=this.getValue(),this.element.dispatchEvent(new Event('input'))}),this.input.addEventListener('paste',()=>setTimeout(savePartial,0)),this.container.addEventListener('mousedown',(a)=>{this.refocus(a)}),this.container.addEventListener('touchstart',(a)=>{this.refocus(a)}),this.savePartial(this.element.value),this.enabled=!0)}disable(){this.enabled&&!this.options.disabled&&(this.reset(),this.enabled=!1)}select(a){let b=this.container.querySelector('.is-active');b&&b.classList.remove('is-active'),a&&a.classList.add('is-active')}addTag(b){if(~b.indexOf(this.options.delimiter)&&(b=b.split(this.options.delimiter)),Array.isArray(b))return b.forEach((a)=>{this.addTag(a)});let c=b&&b.trim();if(!c)return!1;if('true'==this.options.lowercase&&(c=c.toLowerCase()),'true'==this.options.uppercase&&(c=c.toUpperCase()),this.options.duplicates||-1===this.tags.indexOf(c)){this.tags.push(c);let b=document.createElement('div');b.className='control',b.setAttribute('data-tag',c);let d=document.createElement('div');d.className='tags',d.classList.add('has-addons');let e=document.createElement('span');if(e.className='tag',e.classList.add('is-active'),this.select(e),e.innerHTML=c,d.appendChild(e),this.options.allowDelete){let b=document.createElement('a');b.className='tag',b.classList.add('is-delete'),a.forEach((a)=>{b.addEventListener(a,(a)=>{let b,c=a.target.parentNode,d=Array.prototype.slice.call(this.container.querySelectorAll('.tag')).pop(),e=this.caretAtStart(this.input);if(c&&(b=this.container.querySelector('[data-tag="'+c.innerText.trim()+'"]')),b)this.select(b.previousSibling),this.container.removeChild(b),this.tags.splice(this.tags.indexOf(b.getAttribute('data-tag')),1),this.setInputWidth(),this.save();else if(d&&e)this.select(d);else return})}),d.appendChild(b)}b.appendChild(d),this.container.insertBefore(b,this.input)}}getValue(){return this.tags.join(this.options.delimiter)}setValue(a){Array.prototype.slice.call(this.container.querySelectorAll('.tag')).forEach((a)=>{this.tags.splice(this.tags.indexOf(a.innerHTML),1),this.container.removeChild(a)}),this.savePartial(a)}setInputWidth(){let a=Array.prototype.slice.call(this.container.querySelectorAll('.control')).pop();this.container.offsetWidth&&(this.input.style.width=Math.max(this.container.offsetWidth-(a?a.offsetLeft+a.offsetWidth:30)-30,this.container.offsetWidth/4)+'px')}savePartial(a){'string'==typeof a||Array.isArray(a)||(a=this.input.value),!1!==this.addTag(a)&&(this.input.value='',this.save(),this.setInputWidth())}save(){this.element.value=this.tags.join(this.options.delimiter),this.element.dispatchEvent(new Event('change'))}caretAtStart(a){try{return 0===a.selectionStart&&0===a.selectionEnd}catch(b){return''===a.value}}refocus(a){return(a.target.classList.contains('tag')&&this.select(a.target),a.target===this.input)?this.select():(this.input.focus(),a.preventDefault(),!1)}reset(){this.tags=[]}destroy(){this.disable(),this.reset(),this.element=null}}return c});